syntax = "proto3";
package aadk.v1;

import "aadk/v1/common.proto";

enum BuildVariant {
  BUILD_VARIANT_UNSPECIFIED = 0;
  BUILD_VARIANT_DEBUG = 1;
  BUILD_VARIANT_RELEASE = 2;
}

enum ArtifactType {
  ARTIFACT_TYPE_UNSPECIFIED = 0;
  ARTIFACT_TYPE_APK = 1;
  ARTIFACT_TYPE_AAB = 2;
  ARTIFACT_TYPE_AAR = 3;
  ARTIFACT_TYPE_MAPPING = 4;
  ARTIFACT_TYPE_TEST_RESULT = 5;
}

message BuildRequest {
  Id project_id = 1;
  BuildVariant variant = 2;
  bool clean_first = 3;
  repeated KeyValue gradle_args = 4;
  Id job_id = 5;
  string module = 6;
  string variant_name = 7;
  repeated string tasks = 8;
}

message BuildResponse { Id job_id = 1; }

message Artifact {
  string name = 1;
  string path = 2;
  uint64 size_bytes = 3;
  string sha256 = 4;
  repeated KeyValue metadata = 5;
  ArtifactType type = 6;
}

message ArtifactFilter {
  repeated string modules = 1;
  string variant = 2;
  repeated ArtifactType types = 3;
  string name_contains = 4;
  string path_contains = 5;
}

message ListArtifactsRequest {
  Id project_id = 1;
  BuildVariant variant = 2;
  ArtifactFilter filter = 3;
}
message ListArtifactsResponse { repeated Artifact artifacts = 1; }

service BuildService {
  rpc Build(BuildRequest) returns (BuildResponse);
  rpc ListArtifacts(ListArtifactsRequest) returns (ListArtifactsResponse);
}
